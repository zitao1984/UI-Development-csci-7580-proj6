(this.webpackJsonpngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject=this.webpackJsonpngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject||[]).push([[0],{120:function(e,t,n){},126:function(e,t,n){},129:function(e,t,n){},130:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),s=n(25),r=n.n(s),i=n(11),l=(n(120),n(12)),o=n(22),d="logged in",u="logged out",j="invalid login",b="network error",h="failed to register",m="successfully registered",f="username is not availble",O="loading",g="success",p=n(93),x=n(139),v=n(135),N=n(109),y=n(26),w=n(70),S=n.n(w),C=n(87),_="COMPLETE_ONBOARDING",E="LOGIN_SUCCESS",k="INVALID_LOGIN",I="LOADING",D="LOADING_SUCCESS",U="LOGIN_NETWORK_ERROR",T="LOGOUT",L="POPULATE_FILES",A="REGISTER_SUCCESS",G="REGISTER_FAIL",P="POPULATE_USERS",R="POPULATE_CHATS",F="POPULATE_MESSAGES",H="STORE_FILE",M="REGISTER_EXISTED",z="DELETE_CHATS",B="ADD_PEOPLE_TO_CHAT",J="POPULATE_MESSAGES_BY_ID",V="DELETE_PEOPLE_FROM_CHAT",W=n(64),K=n(97),q={status:u,user:{onboardingStatus:!1}},Y={users:[]},X={chats:[]},Q=n(48),Z={messages:[],currentMessages:[]},$={files:[]},ee=O,te=Object(W.c)({loading:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:return Object(y.a)(Object(y.a)({},e),{},{status:O});case D:return Object(y.a)(Object(y.a)({},e),{},{status:g});default:return e}},login:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case _:return console.log("ONBOARDING REDUCER REACHED",e.user),{status:d,user:t.payload.user};case E:return{status:d,user:t.payload.user};case k:return{status:j};case U:return{status:b};case T:return{status:u,user:t.payload.user};case A:return{status:m};case G:return{status:h};case M:return{status:f};default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case P:return{users:t.payload.users};default:return e}},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case R:case z:case B:case V:return{chats:t.payload.chats};default:return e}},messages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:return{messages:Object(Q.a)(t.payload.messages),currentMessages:[]};case J:return{messages:Object(Q.a)(e.messages),currentMessages:t.payload.currentMessages};default:return e}},files:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return console.log("REDUCER REACHED"),{files:t.payload.files};case H:return Object(Q.a)(t.payload.files);case T:return $;default:return e}}}),ne=Object(W.d)(te,Object(W.a)(K.a)),ce=n(88);n(132),n(131);ce.a.initializeApp({apiKey:"AIzaSyBA6zMNW8McJOqHfXvedS0taLqdTuxpTJE",authDomain:"cs7580-final-project.firebaseapp.com",projectId:"cs7580-final-project",storageBucket:"cs7580-final-project.appspot.com",messagingSenderId:"891554190109",appId:"1:891554190109:web:bf6ba1d0f51e32059707f4"});var ae=ce.a,se=ae.firestore(),re=function(e){return{type:E,payload:{user:e}}},ie=function(e,t){return function(n){se.collection("users").where("username","==",e).where("password","==",t).get().then((function(e){if(1===e.size){var t=e.docs[0],c={id:t.id,firstname:t.data().firstname,lastname:t.data().lastname,username:t.data().username,onboardingStatus:t.data().onboardingStatus};console.log("user that logged in ",c),n(re(c)),console.log("yay logged in success",ne.getState())}else console.log("login was not successful"),n({type:k})})).catch((function(e){console.log(e),n({type:U})}))}},le=function(e){return oe(e)},oe=function(e){return se.collection("users").get().then((function(t){var n=[];return t.forEach((function(e){n.push(Object(y.a)({id:e.id},e.data()))})),n.find((function(t){return t.username===e}))}))},de=function(e){return function(t){se.collection("users").doc(e).get().then((function(e){if(!e.exists)return console.log("No such document!"),null;var n=Object(y.a)({id:e.id},e.data());console.log("Document data:",n),t(re(n))})).catch((function(e){return console.log("Error getting document:",e),null}))}},ue=function(){var e=ne.getState().login.user;return{type:_,payload:{user:{firstname:e.firstname,id:e.id,lastname:e.lastname,onboardingStatus:!0,username:e.username}}}},je=function(){var e=ne.getState().login.user.id;return console.log(e),function(){var t=Object(C.a)(S.a.mark((function t(n){var c;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=se.collection("users").doc(e),console.log("DOC REF",c),t.next=4,c.update({onboardingStatus:!0});case 4:n(ue());case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},be=function(){return function(e){se.collection("users").limit(25).get().then((function(t){var n=[];t.forEach((function(e){n.push(Object(y.a)({id:e.id},e.data()))})),e(function(e){return{type:P,payload:{users:e}}}(n))})).catch((function(e){return console.log(e)}))}},he=function(e){return{type:R,payload:{chats:e}}},me=function(e){return{type:F,payload:{messages:e}}},fe=function(e,t,n,c,a,s,r,i){var l=ne.getState().files;return function(o){se.collection("chats").doc(e).collection("messages").add({chatId:e,content:t,fileName:n,fileUrl:c,participants:a,sender:s,timestamp:r,type:i}).then((function(d){var u=l.files.concat([{chatId:e,content:t,fileName:n,fileUrl:c,participants:a,sender:s,timestamp:r,type:i}]);o(function(e){return{type:H,payload:{files:e}}}(u))})).catch((function(e){console.log("Error adding file:",e)}))}},Oe=function(e,t){var n=ne.getState().chats.chats;return function(c){se.collection("chats").doc(e).update({participants:t}).then((function(){var a=n.findIndex((function(t){return t.id===e}));n[a].participants=t,c(function(e){return{type:B,payload:{chats:e}}}(n))})).catch((function(e){return console.log("Error getting document:",e),null}))}},ge=n(41),pe=n(63),xe=n(39),ve=n(1),Ne=function(e){var t=Object(i.c)((function(e){return e.login.user})),n=Object(i.c)((function(e){return e.chats.chats})),a=Object(c.useState)({chatID:"",isValid:void 0}),s=Object(l.a)(a,2),r=s[0],d=s[1],u=Object(i.b)(),j=Object(Q.a)(new Set(n.map((function(e){return e.id}))));function b(e,t,n){return n.indexOf(e)===t}var h=function(){d({chatID:"",isValid:void 0})};return Object(ve.jsxs)(ge.a,Object(y.a)(Object(y.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(ve.jsx)(ge.a.Header,{closeButton:!0,children:Object(ve.jsx)(ge.a.Title,{id:"contained-modal-title-vcenter",children:"Add to chat by code"})}),Object(ve.jsx)(ge.a.Body,{children:Object(ve.jsx)(xe.a,{children:Object(ve.jsxs)(xe.a.Group,{controlId:"title",children:[Object(ve.jsx)(xe.a.Label,{children:"Code"}),Object(ve.jsx)(xe.a.Control,{type:"string",valuse:r,onChange:function(e){var t;d({chatID:(t=e).target.value,isValid:j.includes(t.target.value)})},required:!0}),Object(ve.jsx)("div",{className:"invalid-feedback",style:r.isValid?{display:"none"}:{display:"block"},children:"Cannot find this chat, try to check code  "})]})})}),Object(ve.jsx)(ge.a.Footer,{children:Object(ve.jsx)(o.b,{to:"".concat(r.chatID),children:Object(ve.jsx)(pe.a,{className:"btn btn-primary",type:"submit",disabled:!r.isValid,onClick:function(){var c=n.filter((function(e){return e.id===r.chatID}));c[0].participants.push(t.id);var a=c[0].participants.filter(b);u(Oe(c[0].id,a)),h(),e.onHide(!1)},children:"Join"})})})]}))},ye=function(e){return Object(ve.jsx)("div",{className:"slide-"+e.slideStatus,children:e.children})},we=function(e){return Object(ve.jsx)("button",{className:"indicator",onClick:e.clickHandler,children:Object(ve.jsx)("div",{className:"circle indicator-"+e.slideStatus,children:" "})})},Se=function(){var e=Object(c.useState)(1),t=Object(l.a)(e,2),n=t[0],a=t[1],s=Object(i.b)(),r=function(e){return e===n?"active":"inactive"};return Object(ve.jsxs)("div",{className:"slides-bg center bg-white my-5 text-center",children:[Object(ve.jsxs)(ye,{slideStatus:r(1),slideId:1,children:[Object(ve.jsx)("h1",{className:"",children:"Join  a chat"}),Object(ve.jsx)("p",{children:"Join a chat by entering a code, or select an existing chat from the panel on the left"}),Object(ve.jsx)("div",{className:"fit my-4",children:Object(ve.jsx)("img",{src:"/cs7580sp21-seattle/ngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject/onboarding1.PNG",className:"img-fluid",alt:"Joining Chat"})})]}),Object(ve.jsxs)(ye,{slideStatus:r(2),slideId:2,children:[Object(ve.jsx)("h1",{className:"",children:"Chat with friends and family"}),Object(ve.jsx)("p",{children:"Just type your message, and hit the send button on the bottom right"}),Object(ve.jsx)("div",{className:"fit my-4",children:Object(ve.jsx)("img",{src:"/cs7580sp21-seattle/ngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject/onboarding2.PNG",className:"img-fluid",alt:"Chat View"})})]}),Object(ve.jsxs)(ye,{slideStatus:r(3),slideId:3,children:[Object(ve.jsx)("h1",{className:"",children:"Upload Images"}),Object(ve.jsx)("p",{children:"Select the upload image button (at the bottom on the chat window, on the left) to upload an image."}),Object(ve.jsx)("p",{children:"Then, click on the check mark next to the file name to confirm the upload"}),Object(ve.jsx)("div",{className:"fit my-4",children:Object(ve.jsx)("img",{src:"/cs7580sp21-seattle/ngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject/onboarding3.PNG",className:"img-fluid",alt:"Upload Images."})})]}),Object(ve.jsxs)(ye,{slideStatus:r(4),slideId:4,children:[Object(ve.jsx)("h1",{className:"",children:"Check Out The Gallery"}),Object(ve.jsx)("p",{children:"Select the blue button on the top right to view a chat's image gallery"}),Object(ve.jsx)("div",{className:"fit my-4",children:Object(ve.jsx)("img",{src:"/cs7580sp21-seattle/ngan_le_zitao_shen_tom_mcgourty_ma_lora_ong_finalproject/onboarding4.PNG",className:"img-fluid",alt:"Gallery View"})})]}),Object(ve.jsxs)("div",{className:"slides-controls",children:[Object(ve.jsx)(o.b,{to:"/",className:"align-left control-btn",onClick:function(){return s(je())},children:"Skip"}),Object(ve.jsx)("div",{className:"align-center",children:function(){for(var e=[],t=function(t){e.push(Object(ve.jsx)(we,{slideStatus:r(t),slideID:t,clickHandler:function(){return a(t)}},t))},n=1;n<=4;n++)t(n);return e}()}),n<4?Object(ve.jsx)("button",{className:"align-right control-btn",onClick:function(){n<4?a(n+1):s(je())},children:"Next"}):Object(ve.jsx)(o.b,{to:"/",className:"align-right control-btn",onClick:function(){return s(je())},children:"Done"})]})]})},Ce=function(){var e=Object(i.c)((function(e){return e.login})),t=Object(i.b)(),n=Object(i.c)((function(e){return e.login.user.onboardingStatus})),a=(Object(i.c)((function(e){return e.users})),Object(c.useState)(!1)),s=Object(l.a)(a,2),r=s[0],u=s[1];console.log("STATE",n);var j=Object(ve.jsxs)(p.a,{children:[Object(ve.jsxs)(p.a.Item,{children:["Hello ",e.user&&e.user.username,"!"]},"1"),Object(ve.jsx)(p.a.Item,{onClick:function(){t({type:T,payload:{user:{onboardingStatus:!1}}})},children:"Log Out"},"2")]});return Object(ve.jsx)(x.b,{wrap:!0,children:Object(ve.jsxs)("div",{className:"hero-image",children:[Object(ve.jsx)("div",{children:Object(ve.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark",children:Object(ve.jsxs)("div",{className:"container-fluid",children:[Object(ve.jsx)("a",{className:"navbar-brand ",href:"#",children:Object(ve.jsx)("p",{className:"display-6 ",children:"Chat App |"})}),Object(ve.jsx)("div",{id:"navbarNav",children:Object(ve.jsxs)("ul",{className:"navbar-nav",children:[e.status===d&&Object(ve.jsx)("li",{className:"nav-item",children:Object(ve.jsxs)("a",{className:"nav-link ",href:"#",tabIndex:"-2","aria-disabled":"true",children:[Object(ve.jsx)("button",{className:"btn btn-warning",type:"submit",onClick:function(){return u(!0)},children:"Join Group by Code"}),Object(ve.jsx)(Ne,{show:r,onHide:function(){return u(!1)}})]})}),e.status===d?Object(ve.jsx)(v.a,{overlay:j,children:Object(ve.jsx)("div",{className:"avatar-home",children:Object(ve.jsx)(N.a,{style:{color:"#f56a00",backgroundColor:"#fde3cf"},size:"large",children:e.user&&e.user.username[0].toUpperCase()})})}):Object(ve.jsx)("li",{className:"nav-item",children:Object(ve.jsx)("a",{className:"nav-link ",href:"#",tabIndex:"-1","aria-disabled":"true",children:Object(ve.jsx)(o.b,{to:"/signin",className:"btn btn-outline-dark",style:{color:"white"},children:"Login"})})})]})})]})})}),Object(ve.jsxs)("div",{className:"hero-text",children:[Object(ve.jsx)("h1",{className:"fw-bold display-1",children:"Welcome to the chat app"}),Object(ve.jsx)("p",{children:"Connect with your friends and family"}),e.status===d&&Object(ve.jsx)(ve.Fragment,{children:n?Object(ve.jsx)(o.b,{to:"/chats",className:"btn btn-light",children:"Go to My Chat"}):Object(ve.jsxs)(ve.Fragment,{children:[Object(ve.jsx)(o.b,{to:"/chats",className:"btn btn-light mx-4",children:"Go to My Chat"}),Object(ve.jsx)(o.b,{to:"/onboarding",className:"btn btn-light mx-4",children:"Visit The Tutorial"})]})})]})]})})},_e=n(24),Ee=!1,ke=function(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(""),r=Object(l.a)(s,2),u=r[0],j=r[1],m=Object(i.c)((function(e){return e.login})),O=Object(_e.f)(),g=Object(i.b)(),p=function(){g(function(e,t){return function(){var n=Object(C.a)(S.a.mark((function n(c){return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,le(e);case 2:n.sent?(console.log("This username has already existed"),c({type:M})):(console.log("2"),se.collection("users").add({onboardingStatus:!1,username:e,password:t}).then((function(e){var t=e.id;c(de(t)),c({type:A})})).catch((function(e){console.log("Unable to register new user"),c({type:G})})));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(n,u)),v()},x=function(e){13===e.keyCode&&(e.preventDefault(),p())},v=function(){Ee=!1,a(""),j("")};return Object(c.useEffect)((function(){m.status==d&&O.push("/")})),Object(ve.jsx)(ve.Fragment,{children:Object(ve.jsx)("div",{id:"bg-login",children:Object(ve.jsxs)("div",{className:"outer-box-login",children:[Object(ve.jsx)("h1",{className:"welcome-title-signup",children:"Create Account "}),Object(ve.jsxs)("p",{className:"has-account",style:{color:"grey"},children:["Already have an account? ",Object(ve.jsx)(o.b,{to:"/signin",children:"Sign In"})]}),Object(ve.jsxs)("div",{className:"row",children:[Object(ve.jsx)("div",{className:"col-12 col-sm-1",children:Object(ve.jsx)("label",{htmlFor:"username",className:"form-label sr-only"})}),Object(ve.jsx)("div",{className:"col-9",children:Object(ve.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control ",value:n,placeholder:"Username",onChange:function(e){Ee=!0,a(e.target.value)},onKeyUp:function(e){return x(e)}})})]}),Object(ve.jsxs)("div",{className:"row my-4",children:[Object(ve.jsx)("div",{className:"col-12 col-sm-1",children:Object(ve.jsx)("label",{htmlFor:"password",className:"form-label"})}),Object(ve.jsx)("div",{className:"col-9",children:Object(ve.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",value:u,placeholder:"Password",onChange:function(e){Ee=!0,j(e.target.value)},onKeyUp:function(e){return x(e)}})})]}),!Ee&&m.status===h&&Object(ve.jsx)("div",{className:"alert alert-danger",children:"Something went wrong!"}),!Ee&&m.status===b&&Object(ve.jsx)("div",{className:"alert alert-danger",children:"Unable to connect to the server. Please check your internet connection."}),!Ee&&m.status===f&&Object(ve.jsx)("div",{className:"alert alert-danger",children:"This username is not availble, please pick another one!"}),Object(ve.jsx)("div",{className:"row",children:Object(ve.jsx)("div",{className:"col",children:Object(ve.jsx)("button",{className:"play-btn",onClick:p,children:Object(ve.jsx)("strong",{children:"Register"})})})})]})})})},Ie=(n(124),n(136)),De=!1,Ue=function(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(""),r=Object(l.a)(s,2),u=r[0],h=r[1],m=Object(i.c)((function(e){return e.login})),f=Object(_e.f)(),O=Object(i.b)(),g=function(){O(ie(n,u)),x()},p=function(e){13===e.keyCode&&(e.preventDefault(),g())},x=function(){De=!1,a(""),h("")};return Object(c.useEffect)((function(){m.status==d&&f.push("/")})),Object(ve.jsx)(ve.Fragment,{children:Object(ve.jsxs)("div",{id:"bg-login",children:[Object(ve.jsx)(Ie.a,{ghost:!1,onBack:function(){return f.push("/")},subTitle:"Back to Homepage"}),Object(ve.jsxs)("div",{className:"outer-box-login",children:[Object(ve.jsx)("h1",{className:"welcome-title",children:"Welcome Back,"}),Object(ve.jsxs)("div",{className:"row",children:[Object(ve.jsx)("div",{className:"col-12 col-sm-2 ",children:Object(ve.jsx)("label",{htmlFor:"username",className:"form-label",children:"Username:"})}),Object(ve.jsx)("div",{className:"col-9",children:Object(ve.jsx)("input",{type:"text",id:"username",name:"username",className:"form-control ",value:n,onChange:function(e){De=!0,a(e.target.value)},onKeyUp:function(e){return p(e)}})})]}),Object(ve.jsxs)("div",{className:"row my-4",children:[Object(ve.jsx)("div",{className:"col-12 col-sm-2",children:Object(ve.jsx)("label",{htmlFor:"password",className:"form-label",children:"Password:"})}),Object(ve.jsx)("div",{className:"col-9",children:Object(ve.jsx)("input",{type:"password",id:"password",name:"password",className:"form-control",value:u,onChange:function(e){De=!0,h(e.target.value)},onKeyUp:function(e){return p(e)}})})]}),!De&&m.status===j&&Object(ve.jsx)("div",{className:"alert alert-danger",children:"Invalid username / password! Please try again."}),!De&&m.status===b&&Object(ve.jsx)("div",{className:"alert alert-danger",children:"Unable to connect to the server. Please check your internet connection."}),Object(ve.jsx)("div",{className:"row",children:Object(ve.jsx)("div",{className:"col",children:Object(ve.jsx)("button",{className:"play-btn",onClick:g,children:Object(ve.jsx)("strong",{children:"Login"})})})}),Object(ve.jsxs)("p",{className:"register-sign",style:{color:"grey"},children:["Don't have an account? ",Object(ve.jsx)(o.b,{to:"/signup",children:"Register now "})]})]})]})})},Te=(n(125),n(126),function(e){var t=Object(i.c)((function(e){return e.login})),n=Object(i.c)((function(e){return e.users})),c=new Date(e.message.timestamp).toDateString();return Object(ve.jsx)("div",{children:t.user.id===e.message.sender?Object(ve.jsx)("div",{className:"media w-50 mb-3",style:{marginLeft:"auto"},children:Object(ve.jsxs)("div",{className:"media-body",children:[Object(ve.jsxs)("div",{className:"bg-primary rounded py-2 px-3 mb-2",children:[""!==e.message.fileUrl&&"image/jpeg"===e.message.type||"image/png"===e.message.type?Object(ve.jsx)("a",{href:e.message.fileUrl,target:"_blank",rel:"noopener noreferrer",children:Object(ve.jsx)("img",{src:e.message.fileUrl,alt:"Image uploaded by "+e.message.sender+" on "+c})}):""!==e.message.fileUrl?Object(ve.jsx)("p",{className:"text-small mb-0 text-muted",children:Object(ve.jsx)("a",{href:e.message.fileUrl,children:e.message.fileName})}):"",Object(ve.jsx)("p",{className:"text-small mb-0 text-white",children:e.message.content})]}),Object(ve.jsx)("div",{style:{marginLeft:"auto"},children:Object(ve.jsx)("p",{className:"small text-muted",children:c})})]})}):Object(ve.jsxs)("div",{className:"row",children:[Object(ve.jsx)("div",{className:"col-1",children:Object(ve.jsx)("img",{alt:"user",width:"50",src:"https://res.cloudinary.com/mhmd/image/upload/v1564960395/avatar_usae7z.svg"})}),Object(ve.jsx)("div",{className:"media w-50 mb-3",children:Object(ve.jsxs)("div",{className:"media-body ml-3",children:[Object(ve.jsxs)("div",{className:"bg-light rounded py-2 px-3 mb-2",children:[""!==e.message.fileUrl&&"image/jpeg"===e.message.type||"image/png"===e.message.type?Object(ve.jsx)("a",{href:e.message.fileUrl,target:"_blank",rel:"noopener noreferrer",children:Object(ve.jsx)("img",{src:e.message.fileUrl,alt:"Image uploaded by "+e.message.sender+" on "+c})}):""!==e.message.fileUrl?Object(ve.jsx)("p",{className:"text-small mb-0 text-muted",children:Object(ve.jsx)("a",{href:e.message.fileUrl,children:e.message.fileName})}):"",Object(ve.jsx)("p",{className:"text-small mb-0 text-muted",children:e.message.content})]}),Object(ve.jsxs)("p",{class:"small text-muted",children:[n.users.filter((function(t){return t.id===e.message.sender}))[0].username," | ",new Date(e.message.timestamp).toLocaleTimeString("en-US")," | ",new Date(e.message.timestamp).toDateString()]})]})})]})})}),Le=(n(85),n(34)),Ae=n(35),Ge=n(80),Pe=function(e){var t=new Date(e.publication).toDateString();return Object(ve.jsx)("div",{className:"col-12 col-sm-4 col-md-2 col-lg-2 col-xl-2 m-2",children:Object(ve.jsxs)("div",{className:"row",children:[Object(ve.jsx)("img",{src:e.media,alt:"Image uploaded on "+t}),Object(ve.jsxs)("p",{children:["Image uploaded on ",t]})]})})},Re=n(137),Fe=(Date.now(),Date.now(),Date.now(),Date.now(),Date.now(),Date.now(),Date.now(),Date.now(),function(e){console.log("GALLEY PROPS",e);Object(i.b)();return Object(ve.jsx)("div",{children:Object(ve.jsx)("div",{className:"row d-flex justify-content-left",children:0===e.files.length?Object(ve.jsx)(Re.a,{status:"500",title:"No file for this chat",dd:!0}):e.files.map((function(e){return Object(ve.jsx)(Pe,{media:e.fileUrl,author:e.sender,publication:e.timestamp})}))})})}),He=function(e){Object(i.c)((function(e){return e.files})),Object(i.c)((function(e){return e.chats})),Object(i.c)((function(e){return e.users}));var t=Object(i.c)((function(e){return e.login.user})),n=Object(i.c)((function(e){return e.messages})),a=Object(c.useState)([]),s=Object(l.a)(a,2),r=s[0],o=(s[1],Object(c.useState)("")),d=Object(l.a)(o,2),u=d[0],j=d[1],b=Object(c.useState)(""),h=Object(l.a)(b,2),m=h[0],f=h[1],O=Object(c.useState)(!1),g=Object(l.a)(O,2),p=g[0],x=g[1],v=Object(c.useState)(""),N=Object(l.a)(v,2),w=N[0],S=N[1],C=Object(c.useState)(!1),_=Object(l.a)(C,2),E=_[0],k=_[1],I=Object(c.useState)([]),D=Object(l.a)(I,2),U=D[0],T=D[1],L=Object(c.useState)([]),A=Object(l.a)(L,2),G=(A[0],A[1],Object(c.useState)(n.messages.length)),P=Object(l.a)(G,2),R=(P[0],P[1]),F=(Object(i.c)((function(e){return e.login.user})),Object(_e.g)().cid),H=ae.storage(),M=Object(i.b)(),z=function(e){M(""!==u?fe(F,w,u.name,m,r,t.id,(new Date).getTime(),u.type):function(e,t,n,c,a,s,r,i){return function(l){var o=ne.getState().messages;se.collection("chats").doc(e).collection("messages").add({chatId:e,content:t,fileName:n,fileUrl:c,participants:a,sender:s,timestamp:r,type:i}).then((function(d){console.log(o);var u=o.messages.concat([{id:d.id,chatId:e,content:t,fileName:n,fileUrl:c,participants:a,sender:s,timestamp:r,type:i}]);l(me(u))})).catch((function(e){console.log("Could not add the message")}))}}(F,w,"","",r,t.id,(new Date).getTime(),"")),e.preventDefault(),B()};Object(c.useEffect)((function(){!function(e){var t=[];n.messages.map((function(n){n.chatId===e&&0!==n.fileUrl.length&&t.push(n)})),console.log("FILES",t),T(t)}(F),k(!1)}),[F,n.messages]),Object(c.useEffect)((function(){var e=ae.firestore().collection("chats").doc(F).collection("messages").onSnapshot((function(e){if(e.size>0){var t=[];e.forEach((function(e){t.push(Object(y.a)({id:e.id},e.data()))})),M(me(t))}}));return function(){e()}}),[F]);Object(c.useEffect)((function(){!function(){var e=document.getElementById("messageWindow");if(e){var t=(null===e||void 0===e?void 0:e.scrollHeight)-(null===e||void 0===e?void 0:e.clientHeight);e.scrollTo(0,t)}}()}),[n.messages]);var B=function(){j(""),x(""),f(""),S("")};return Object(ve.jsx)("div",{children:e.currentChat&&Object(ve.jsx)("div",{children:Object(ve.jsxs)("div",{children:[Object(ve.jsx)("div",{className:"message-header mt-2",children:Object(ve.jsx)(Ie.a,{className:"site-page-header bg-white",title:""!==e.currentChat.chatName?e.currentChat.chatName:e.usernames.join(", "),extra:[Object(ve.jsxs)("div",{className:"message-header",children:[Object(ve.jsxs)("h4",{children:[" Chat Code: ",e.currentChat.id]}),E?Object(ve.jsx)(Ge.a,{title:"Hide Gallery",children:Object(ve.jsx)("button",{className:"btn btn-primary float-end",onClick:function(){return k(!E)},children:Object(ve.jsx)(Le.a,{icon:Ae.d})})}):Object(ve.jsx)(Ge.a,{title:"Show Gallery",children:Object(ve.jsx)("button",{className:"btn btn-primary float-end",onClick:function(){return k(!E)},children:Object(ve.jsx)(Le.a,{icon:Ae.d})})})]})]})}),Object(ve.jsxs)("div",{className:"px-3 py-5 chat-box bg-white",children:[E?Object(ve.jsxs)("div",{className:"messageWindow",children:[console.log("GALLERY",U),Object(ve.jsx)(Fe,{files:U})]}):Object(ve.jsx)("div",{className:"messageWindow",id:"messageWindow",children:n.messages.filter((function(e){return e.chatId===F})).sort((function(e,t){return new Date(e.timestamp)-new Date(t.timestamp)})).map((function(e){return Object(ve.jsx)(Te,{message:e})}))}),Object(ve.jsx)("form",{}),Object(ve.jsxs)("form",{action:"#",className:"bg-light",children:[Object(ve.jsx)("div",{children:Object(ve.jsxs)("div",{className:"upload",children:[Object(ve.jsxs)("span",{children:[Object(ve.jsx)(Ge.a,{title:"Click check to confirm upload after choosing a file or x to cancel",children:Object(ve.jsxs)("label",{htmlFor:"fileupload",children:[Object(ve.jsx)(Le.a,{icon:Ae.j}),Object(ve.jsx)("span",{id:"file-name",children:u.name})]})}),Object(ve.jsx)("input",{type:"file",id:"fileupload",onChange:function(e){return t=e.target.files[0],j(t),R(u.name),void x(!0);var t},onClick:function(e){return e.target.value=null}})]}),Object(ve.jsx)("span",{className:"upload",children:p?Object(ve.jsxs)("div",{children:[Object(ve.jsx)(Le.a,{className:"fa-sm upload-btn upload-check",icon:Ae.a,onClick:function(){H.ref("/files/".concat(u.name)).put(u).on("state_changed",(function(e){console.log(e)}),(function(e){console.log(e)}),(function(){H.ref("files").child(u.name).getDownloadURL().then((function(e){f(e)}))})),console.log(""),x(!1),S(u.name)}}),Object(ve.jsx)(Le.a,{className:"fa-sm upload-btn upload-cancel",icon:Ae.i,onClick:function(){j(""),x(!1)}})]}):""})]})}),Object(ve.jsxs)("div",{className:"input-group",children:[Object(ve.jsx)("input",{type:"text",placeholder:"Type a message","aria-describedby":"button-addon2",class:"form-control rounded-0 border-0 py-4 bg-light",value:w,onChange:function(e){return S(e.target.value)}}),Object(ve.jsx)("div",{className:"input-group-append",children:Object(ve.jsx)("button",{disabled:p,id:"button-addon2",type:"submit",className:"btn btn-link",onClick:function(e){return z(e)},children:Object(ve.jsx)(Le.a,{icon:Ae.f})})})]})]})]})]})})})},Me=(n(129),function(e){var t=Object(c.useState)(""),n=Object(l.a)(t,2),a=n[0],s=n[1],r=function(t){t.preventDefault(),console.log(a),e.submitSearch(a)};return Object(ve.jsx)("div",{className:"search-form container",children:Object(ve.jsxs)("div",{className:"row justify-content-center",children:[Object(ve.jsxs)("div",{className:"col-10 pe-0 ps-0",children:[Object(ve.jsx)("label",{htmlFor:"search",className:"visually-hidden",children:"Search"}),Object(ve.jsx)("input",{id:"search",className:"form-control rounded-start",type:"search",placeholder:e.placeholder,value:a,onChange:function(e){return s(e.target.value)},onKeyUp:function(e){var t;13===(t=e).keyCode&&r(t)}})]}),Object(ve.jsx)("div",{className:"col-2 p-0",children:Object(ve.jsx)("button",{className:"btn btn-secondary",onClick:r,children:Object(ve.jsx)(Le.a,{icon:Ae.h})})})]})})}),ze=function(e){var t=function(t){for(var n=[],c=function(c){var a=e.users.filter((function(e){return e.id===t[c]}));a&&a[0]&&n.push(a[0].username)},a=0;a<t.length;a++)c(a);return n}(e.chat.participants.slice(0,2));return Object(ve.jsxs)("div",{className:"card card-preview",children:[console.log("users from props",e.users),console.log("2",e.chat.participants),Object(ve.jsxs)("a",{className:" stretched-link ",href:!0,children:[Object(ve.jsxs)("h6",{className:"card-header ",children:["Name: ",e.chat.chatName]}),Object(ve.jsx)("div",{children:Object(ve.jsxs)("p",{className:"card-title text-secondary text-center",children:[t.toString()," in the chat"]})})]})]},e.id)},Be=function(e){var t=Object(i.c)((function(e){return e.login.user})),n=Object(i.c)((function(e){return e.users.users})),a=Object(i.c)((function(e){return e.chats.chats})),s=Object(c.useState)(""),r=Object(l.a)(s,2),o=r[0],d=r[1],u=Object(c.useState)([]),j=Object(l.a)(u,2),b=(j[0],j[1]),h=Object(c.useState)([]),m=Object(l.a)(h,2),f=m[0],O=m[1],g=Object(c.useState)(!1),p=Object(l.a)(g,2),x=p[0],v=p[1],N=Object(Q.a)(new Set(a.map((function(e){return e.id})))),w=Object(i.b)(),S=function e(t){var n=function(e){for(var t=[],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=n.length,a=0;a<e;a++)t.push(n.charAt(Math.floor(Math.random()*c)));return t.join("")}(t);return N.includes(n)?e(t):n};Object(c.useEffect)((function(){v(C(f))}),[f]);var C=function(e){if(e.length>0){var t=function(){for(var t=e.split(","),c=function(e){if(0===n.filter((function(n){return n.username===t[e]})).length)return{v:{v:!1}}},a=0;a<t.length;a++){var s=c(a);if("object"===typeof s)return s.v}return{v:!0}}();if("object"===typeof t)return t.v}return!0};function _(e,t,n){return n.indexOf(e)===t}var E=function(){d(""),O([]),b([]),v(!1)};return Object(ve.jsxs)(ge.a,Object(y.a)(Object(y.a)({},e),{},{size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[Object(ve.jsx)(ge.a.Header,{closeButton:!0,children:Object(ve.jsx)(ge.a.Title,{id:"contained-modal-title-vcenter",children:"Create a new chat"})}),Object(ve.jsx)(ge.a.Body,{children:Object(ve.jsxs)(xe.a,{children:[Object(ve.jsxs)(xe.a.Group,{controlId:"title",children:[Object(ve.jsx)(xe.a.Label,{children:"Chat name"}),Object(ve.jsx)(xe.a.Control,{type:"text",valuse:o,onChange:function(e){return d(e.target.value)},required:!0})]}),Object(ve.jsxs)(xe.a.Group,{controlId:"user",children:[Object(ve.jsx)(xe.a.Label,{children:"Add users by username (Multiple users should be separated by commas)"}),Object(ve.jsx)(xe.a.Control,{type:"user",value:f,onChange:function(e){O(e.target.value)}}),Object(ve.jsxs)("div",{className:"invalid-feedback",style:x?{display:"none"}:{display:"block"},children:["Cannot find this last person, try to check spelling"," "]})]})]})}),Object(ve.jsx)(ge.a.Footer,{children:Object(ve.jsx)(pe.a,{className:"btn btn-primary",type:"submit",disabled:!x,onClick:function(){var c=function(){console.log("currentUser",t),console.log("userList",n);var e=n.filter((function(e){return e.username===t.username}));console.log("myUser",e);var c=[e[0].id],a=[t.username];return f.length>0&&function(){for(var e=f.split(","),t=function(t){var s=n.filter((function(n){return n.username===e[t]}));c.push(s[0].id),a.push(e[t])},s=0;s<e.length;s++)t(s)}(),c=c.filter(_),a=a.filter(_),[c,a]}(),a=S(6),s={};s=0===o.length?{chatName:c[1].slice(0,5).toString(),participants:c[0],timestamp:(new Date).getTime()}:{chatName:o,participants:c[0],timestamp:(new Date).getTime()},console.log("new chat",s),w(function(e,t){var n=ne.getState().chats.chats;return function(c){se.collection("chats").doc(t).set({chatName:e.chatName,participants:e.participants,timestamp:e.timestamp}).then((function(e){n.push({id:t,chatName:e.chatName,participants:e.participants,timestamp:e.timestamp}),c(he(n))})).catch((function(e){return console.log(e)}))}}(s,a)),E(),e.onHide(!1)},children:"Create"})})]}))},Je=function(){var e,t=Object(c.useState)(""),n=Object(l.a)(t,2),a=n[0],s=n[1],r=Object(c.useState)(!1),u=Object(l.a)(r,2),j=u[0],b=u[1],h=Object(i.c)((function(e){return e.chats})),m=(Object(i.c)((function(e){return e.messages})),Object(i.c)((function(e){return e.login}))),f=Object(i.c)((function(e){return e.users.users})),O=Object(i.c)((function(e){return e.login.user})),g=h.chats,p=Object(c.useState)(),v=Object(l.a)(p,2),N=v[0],w=v[1],S=Object(c.useState)([]),C=Object(l.a)(S,2),_=C[0],E=(C[1],Object(c.useState)(!0)),k=Object(l.a)(E,2),I=k[0],D=k[1],U=Object(_e.g)(),T=Object(i.b)(),L=g.filter((function(e){return e.participants.includes(O.id)}));return Object(c.useEffect)((function(){!function(e){var t=h.chats.find((function(t){return t.id===e}));t&&w(t)}(U.cid)}),[U]),Object(c.useEffect)((function(){console.log("trying to add new chat"),T(be());var e=ae.firestore().collection("chats").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(Object(y.a)({id:e.id},e.data()))})),T(he(t))}));return function(){e()}}),[h.chats.length]),Object(ve.jsx)(ve.Fragment,{children:m.status===d?Object(ve.jsx)("div",{className:"container-fluid",children:Object(ve.jsxs)("div",{className:"row",children:[I?Object(ve.jsx)("div",{className:"col-md-2 col-xl-2 px-sm-2 bg-light",children:Object(ve.jsxs)("div",{className:"d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100 container-chat sidebar",children:[Object(ve.jsx)(o.b,{to:"/",children:Object(ve.jsx)("button",{className:"btn btn-primary home-button",children:Object(ve.jsx)(Le.a,{icon:Ae.e})})}),Object(ve.jsx)("button",{onClick:function(){return D(!I)},className:"btn btn-primary m-2 d-xs-block",children:Object(ve.jsxs)("span",{children:[Object(ve.jsx)(Le.a,{icon:Ae.b}),Object(ve.jsx)("p",{className:"d-block d-sm-block d-md-none",children:"Go to Messages"})]})}),Object(ve.jsx)("a",{className:" d-flex align-items-center pb-3 text-dark text-decoration-none p-0",children:Object(ve.jsxs)("span",{className:"fs-5 ",children:["Hello ",O.username,"!"]})}),Object(ve.jsx)("div",{className:"search-container",children:Object(ve.jsx)(Me,{placeholder:"Search chat name",submitSearch:s})}),Object(ve.jsxs)("div",{className:"preview-window",children:[Object(ve.jsx)("h5",{className:"text-left",children:"Your chats"}),Object(ve.jsx)(x.b,{direction:"vertical",children:(e=a,e.length>0?L.filter((function(t){return t.chatName===e})):L).map((function(e,t){return Object(ve.jsx)(o.b,{to:"".concat(e.id),children:Object(ve.jsx)(ze,{chat:e,id:t,users:f})})}))})]}),Object(ve.jsx)("div",{className:"d-flex flex-row-reverse",children:Object(ve.jsxs)("div",{className:"p-3",children:[Object(ve.jsxs)(pe.a,{variant:"primary",onClick:function(){return b(!0)},children:[Object(ve.jsx)(Le.a,{icon:Ae.g})," Create"]}),Object(ve.jsx)(Be,{show:j,onHide:b})]})})]})}):Object(ve.jsxs)("div",{className:"col-sm-1 align-items-left align-items-sm-start px-3 pt-2 text-white ",children:[Object(ve.jsx)(o.b,{to:"/",children:Object(ve.jsx)("button",{className:"btn btn-primary m-2 home-button",children:Object(ve.jsx)(Le.a,{icon:Ae.e})})}),Object(ve.jsx)("button",{onClick:function(){return D(!I)},className:"btn btn-primary m-2 ",children:Object(ve.jsx)(Le.a,{icon:Ae.c})})]}),I?Object(ve.jsx)("div",{className:"col-10 d-none d-md-block d-xl-block",children:0===L.length?"":Object(ve.jsx)(He,{currentUser:O,currentChat:N,usernames:_})}):Object(ve.jsx)("div",{className:"col-10",children:0===L.length?"":Object(ve.jsx)(He,{currentUser:O,currentChat:N,usernames:_})})]})}):window.location.href="/"})},Ve=function(){Object(i.c)((function(e){return e.users})),Object(i.c)((function(e){return e.chats}));var e=Object(i.b)();return Object(c.useEffect)((function(){console.log("calling from app"),e(be()),e((function(e){se.collection("chats").limit(25).get().then((function(t){var n=[];t.forEach((function(e){n.push(Object(y.a)({id:e.id},e.data()))})),e(he(n))})).catch((function(e){return console.log(e)}))}))}),[]),Object(ve.jsx)(o.a,{children:Object(ve.jsxs)(_e.c,{children:[Object(ve.jsx)(_e.a,{path:"/signup",children:Object(ve.jsx)(ke,{})}),Object(ve.jsx)(_e.a,{path:"/signin",children:Object(ve.jsx)(Ue,{})}),Object(ve.jsx)(_e.a,{path:["/onboarding"],children:Object(ve.jsx)(Se,{})}),Object(ve.jsx)(_e.a,{path:["/:cid"],children:Object(ve.jsx)(Je,{})}),Object(ve.jsx)(_e.a,{path:["/chats"],children:Object(ve.jsx)(Je,{})}),Object(ve.jsx)(_e.a,{path:"/side",children:Object(ve.jsx)(Je,{})}),Object(ve.jsx)(_e.a,{path:["/","/home"],children:Object(ve.jsx)(Ce,{})})]})})},We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,140)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),s(e),r(e)}))};r.a.render(Object(ve.jsx)(a.a.StrictMode,{children:Object(ve.jsx)(i.a,{store:ne,children:Object(ve.jsx)(Ve,{})})}),document.getElementById("root")),We()},85:function(e,t,n){}},[[130,1,2]]]);
//# sourceMappingURL=main.cfc4065f.chunk.js.map